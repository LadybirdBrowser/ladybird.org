---
import { getCollection } from "astro:content";

const posts = (await getCollection("posts"))
  .filter((post) => post.data.type !== "Hidden")
  .map((post) => ({
    date: post.data.date,
    title: post.data.title,
    description: post.data.description,
    href: `/posts/${post.slug}`,
  }));

const newsletters = (
  await getCollection("newsletters", ({ data }) =>
    import.meta.env.PROD ? data.draft !== true : true
  )
).map((newsletter) => ({
  date: newsletter.data.date,
  title: newsletter.data.title,
  description: newsletter.data.description,
  href: `/newsletter/${newsletter.data.date.toISOString().split("T")[0]}`,
}));

const allNews = [...posts, ...newsletters]
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime())
  .slice(0, 6);
---

<section id="news" class="section">
  <div class="container">
    <h2 class="section-heading">News</h2>

    <div class="posts-list">
      {
        allNews.map((item) => (
          <div class="post-row">
            <span class="post-date">
              {new Date(item.date).toISOString().slice(0, 10)}
            </span>
            <div class="post-info">
              <a href={item.href}>{item.title}</a>
              <p>{item.description}</p>
            </div>
          </div>
        ))
      }
    </div>

    <a href="/news/" class="see-all-link">See all posts &rarr;</a>
  </div>
</section>

<style>
  .posts-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
  }

  .post-row {
    display: flex;
    gap: 20px;
    align-items: baseline;
  }

  .post-date {
    font-family: var(--font-mono);
    font-size: 13px;
    color: var(--text-muted);
    flex-shrink: 0;
    min-width: 90px;
  }

  .post-info a {
    font-weight: var(--weight-bold);
    color: var(--text-primary);
    text-decoration-color: rgba(255, 255, 255, 0.1);
  }

  .post-info a:hover {
    text-decoration-color: var(--color-accent);
    color: var(--color-accent);
  }

  .post-info p {
    font-size: 14px;
    color: var(--text-muted);
    margin: 2px 0 0;
  }

  .see-all-link {
    display: block;
    margin-top: 30px;
    text-align: center;
    font-family: var(--font-mono);
    font-size: 13px;
    color: var(--text-muted);
    text-decoration: none;
    transition: color 0.2s;
  }

  .see-all-link:hover {
    color: var(--color-accent);
  }

  @media (max-width: 640px) {
    .post-row {
      flex-direction: column;
      gap: 2px;
    }
  }
</style>
